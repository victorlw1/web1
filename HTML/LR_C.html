<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学校自动布局生成器</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="title">
                <a href="">
                    <p>学校自动布局生成器</p>
                </a>
            </div>
            <div class="navbar">
                <ul>
                    <li><a href="">
                            <p>产品介绍</p>
                        </a></li>
                    <li><a href="">
                            <p>关于我们</p>
                        </a></li>
                </ul>
            </div>
        </div>
        <div class="left">
            <div class="title">
                <p>笔刷选项</p>
            </div>
            <div class="brush-selection">
                <div class="sub-title sub-title-road">
                    <p>绘制道路</p>
                </div>
                <ul id="road-selections">
                    <li id="main-road" class="main-road">
                        <p class="main-road">主干道</p>
                        <div class="main-road"></div>
                    </li>
                    <li id="submain-road" class="submain-road">
                        <p class="submain-road">次干道</p>
                        <div class="submain-road"></div>
                    </li>
                    <li id="branch-road" class="branch-road">
                        <p class="branch-road">支路</p>
                        <div class="branch-road"></div>
                    </li>
                </ul>
                <div class="sub-title sub-title-field">
                    <p>绘制场地</p>
                </div>
                <ul id="polygon-selections">
                    <li id="square-field" class="square-field">
                        <p class="square-field">方形场地</p>
                    </li>
                    <li id="polygon-field" class="polygon-field">
                        <p class="polygon-field">多边形场地</p>
                    </li>
                    <li id="custom-field" class="custom-field">
                        <p class="custom-field">自定义场地</p>
                    </li>
                </ul>
            </div>
            <div class="option">
                <div id="redo" class="redo">
                    <p>左板撤回</p>
                </div>
                <div id="clear" class="clear">
                    <p>清空</p>
                </div>
            </div>
        </div>

        <div class="right">
            <div class="title">
                <p>结果评价</p>
            </div>
            <div class="result-evaluation">
            </div>
        </div>

        <div class="center">
            <div class="content">
                <div class="input">
                    <canvas id="left-board" class="board" width="400px" height="400px"></canvas>
                </div>
                <div class="output">
                    <canvas id="right-board" class="board" width="400px" height="400px"></canvas>
                </div>
                <div class="center_pos">
                    <div id="generate" class="generate">
                        <p>生成布局</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<link rel="stylesheet" href="../CSS/LR_C.css">
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="../JS/LR_C.js"></script>
<script>
    window.addEventListener("load", function () {
        let generate = $("div#generate")[0];
        generate.addEventListener("mousedown", function (e) {
            let input_canvas = $("canvas#left-board")[0];
            let pic_name = "pic_" + Date.now()
            let oA = document.createElement("a");
            oA.download = pic_name; // 设置下载的文件名
            oA.href = input_canvas.toDataURL("image/png");
            document.body.appendChild(oA);
            oA.click();
            oA.remove(); // 下载之后把创建的元素删除
            let isDownloadOver = false;
            let drawPic = function () {
                let img = new Image();
                img.src = "C:\\Users\\59787\\Downloads\\" + pic_name + ".png";
                img.onload = function () {
                    isDownloadOver = true;
                    let output_canvas = $("canvas#right-board")[0];
                    let canvasW = output_canvas.width; //获取画布的宽度
                    let canvasH = output_canvas.height; //获取画布的高度
                    let ctx = output_canvas.getContext("2d");
                    ctx.clearRect(0, 0, canvasW, canvasH)
                    ctx.drawImage(img, 0, 0, canvasW, canvasH);
                    img = null
                }
                if (!isDownloadOver) {
                    setTimeout(drawPic, 1)
                }
            }
            setTimeout(drawPic, 1)
        })
    })
</script>

</html>